var Geolocation=new Class({Implements:[Options],options:{debug:false,cookieLifeTime:1},infoElements:[],vars:{cookie:"",lat:0,lon:0,countryShort:"",mode:-1},initialize:function(a){this.setOptions(a)},setDebug:function(a){this.options.debug=a},setCookieLifetime:function(a){this.options.cookieLifeTime=a},addInfoElement:function(a){if(!this.infoElements[a]){this.infoElements[a]=[]}this.infoElements.include(a)},updateCookie:function(){var a={lat:this.vars.lat,lon:this.vars.lon,countryShort:this.vars.countryShort,mode:this.vars.mode};var b={duration:this.options.cookieLifeTime};if(this.options.debug==true){console.log("Set cookie:");console.log(a);console.log(b)}Cookie.write("Geolocation",JSON.encode(a),b)},removeCookie:function(){Cookie.dispose("Geolocation")},runGeolocation:function(){this.onProgress();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){this.vars.lat=a.coords.latitude;this.vars.lon=a.coords.longitude;this.updatePosition()}.bind(this),function(a){this.updateError(a.code)}.bind(this))}else{if(this.options.debug==true){console.log("Geolocation is not supported by this browser")}this.updateError(10)}},updatePosition:function(){if(this.options.debug==true){console.log("Start location updating");console.log(this.vars)}if(typeof(REQUEST_TOKEN)!=="undefined"){data={action:"GeoSetLocation",lat:this.vars.lat,lon:this.vars.lon,isAJAX:true,REQUEST_TOKEN:REQUEST_TOKEN}}else{data={action:"GeoSetLocation",lat:this.vars.lat,lon:this.vars.lon,isAJAX:true}}new Request.JSON({method:"post",url:"ajax.php",data:data,evalScripts:false,evalResponse:false,onSuccess:function(b,a){if(typeof(REQUEST_TOKEN)!=="undefined"){REQUEST_TOKEN=b.token}if(b.content.success==true){this.vars.countryShort=b.content.countryShort;this.vars.lat=b.content.lat;this.vars.lon=b.content.lon;this.vars.mode=b.content.mode;this.updateCookie();this.onSuccess()}else{this.removeCookie();if(this.options.debug==true){console.log("Error by server");console.log(a)}}}.bind(this),onError:function(b,a){if(this.options.debug==true){console.log("Error by Json Request");console.log(a)}this.onFailure(20)}.bind(this),onFailure:function(b,a){if(this.options.debug==true){console.log("Error by Json Request");console.log(a)}this.onFailure(20)}.bind(this)}).send()},updateError:function(a){if(this.options.debug==true){console.log("Start error updating");console.log(a)}if(typeof(REQUEST_TOKEN)!=="undefined"){data={action:"GeoSetError",errID:a,isAJAX:true,REQUEST_TOKEN:REQUEST_TOKEN}}else{data={action:"GeoSetError",errID:a,isAJAX:true}}new Request.JSON({method:"post",url:"ajax.php",data:data,evalScripts:false,evalResponse:false,onSuccess:function(c,b){if(typeof(REQUEST_TOKEN)!=="undefined"){REQUEST_TOKEN=c.token}if(this.options.debug==true){console.log("Success");console.log(b)}if(c.content.success==true){this.vars.countryShort=c.content.countryShort;this.vars.lat=c.content.lat;this.vars.lon=c.content.lon;this.vars.mode=c.content.mode;this.updateCookie()}this.onFailure(a)}.bind(this),onError:function(c,b){if(this.options.debug==true){console.log("Error by Json Request");console.log(b)}this.onFailure(20)}.bind(this),onFailure:function(c,b){if(this.options.debug==true){console.log("Error by Json Request");console.log(b)}this.onFailure(20)}.bind(this)}).send()},updateInfoElements:function(a){this.infoElements.each(function(b){$(b).set("html",a)})},onProgress:function(){this.updateInfoElements(this.options.options.messages.geo_msc_Start)},afterProgress:function(){this.updateInfoElements(this.options.options.messages.geo_msc_Finished)},onSuccess:function(){window.location.reload()},onFailure:function(a){window.location.reload();if($("geoLocationInformation")){switch(a){case 1:this.updateInfoElements(this.options.options.messages.geo_err_PermissionDenied);break;case 2:this.updateInfoElements(this.options.options.messages.geo_err_PositionUnavailable);break;case 3:this.updateInfoElements(this.options.options.messages.geo_err_TimeOut);break;case 10:this.updateInfoElements(this.options.options.messages.geo_err_UnsupportedBrowser);break;case 20:this.updateInfoElements(this.options.options.messages.geo_err_NoConnection);break;default:this.updateInfoElements(this.options.options.messages.geo_err_UnknownError);break}}}});